<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:t="http://myfaces.apache.org/tomahawk" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich" xmlns:c="http://java.sun.com/jsp/jstl/core" xmlns:jstl="http://java.sun.com/jsp/jstl/functions"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions">
<body>
<ui:composition template="/WEB-INF/templates/widgets/modalPanel.xhtml">
	<ui:param name="panelWidth" value="600" />
	<ui:param name="panelHeight" value="300" />
	<ui:param name="panelId" value="historyPanel" />
	<ui:param name="panelHeader" value="Änderungshistorie für Datensatz #{historyBean.entity.displayString}" />
	
	<ui:define name="panelContent">
		<h:outputText value="Dieser Datensatz wurde von folgenden Personen geändert:" />
		<p>
			<h:outputLabel value="Geändert von" styleClass="label" /> 
			<h:outputText value="#{historyBean.entity.history.changedBy}" /></p>
		<p>
			<h:outputLabel value="Datum:" styleClass="label" /> 
			<h:outputText value="#{historyBean.entity.history.changedAt}" styleClass="content">
				<f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" locale="#{localeBean.locale}" timeZone="#{localeBean.timeZone}" />
			</h:outputText>
		</p>
		<p>
			<h:outputLabel value="Erstellt von" styleClass="label" /> 
			<h:outputText value="#{historyBean.entity.history.createdBy}" /></p>
		<p>
			<h:outputLabel value="Datum:" styleClass="label" /> 
			<h:outputText value="#{historyBean.entity.history.createdAt}" styleClass="content">
				<f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" locale="#{localeBean.locale}" timeZone="#{localeBean.timeZone}" />
			</h:outputText>
		</p>
		<rich:dataTable styleClass="defaultStyle" rendered="#{not empty historyBean.revisionEntries}" value="#{historyBean.revisionEntries}" var="revisionEntry">
			<rich:column styleClass="smallColumn bold">
				<f:facet name="header">
					<h:outputText value="Typ" />
				</f:facet>
				<h:outputText value="#{revisionEntry.type}" />
			</rich:column>
			<rich:column styleClass="mediumColumn center">
				<f:facet name="header">
					<h:outputText value="Datum" />
				</f:facet>
				<h:outputText value="#{revisionEntry.revision.timestamp}">
					<f:convertDateTime pattern="dd.MM.yyyy HH:mm:ss" locale="#{localeBean.locale}" timeZone="#{localeBean.timeZone}" />
				</h:outputText>
			</rich:column>
			<rich:column styleClass="mediumColumn center">
				<f:facet name="header">
					<h:outputText value="Benutzer" />
				</f:facet>
				<h:outputText value="#{revisionEntry.revision.username}" />
			</rich:column>
			<rich:column>
				<f:facet name="header">
					<h:outputText value="Änderungen" />
				</f:facet>
				<h:outputText value="Datensatz wurde erstellt" rendered="#{revisionEntry.type eq 'ADD'}" />
				<h:outputText value="Datensatz wurde gelöscht" rendered="#{revisionEntry.type eq 'DEL'}" />
				<a4j:repeat value="#{revisionEntry.changes}" var="change" rowKeyVar="rowIndex">
					<h:outputText value="Feld '#{change.property}' " />
					<h:outputText value="war '#{change.oldValue}' und " rendered="#{not empty change.oldValue}" />
					<h:outputText value="wurde geändert in '#{change.newValue}'" />
					<h:outputText value=" , " rendered="#{rowIndex lt fn:length(revisionEntry.changes)-1}" />
				</a4j:repeat>
			</rich:column>
		</rich:dataTable>
	</ui:define>

	<ui:define name="panelFooter">
		<div class="left">
			<rich:spacer />
		</div>
		<div class="right">
			<div class="center">
				<h:graphicImage library="images/16x16" name="success.png" styleClass="linkImage" />
				<h:outputLink onclick="#{rich:component(panelId)}.hide(); return false;" styleClass="linkText">
					<h:outputText value="Schließen" />
				</h:outputLink>
			</div>
		</div>
	</ui:define>
</ui:composition>
</body>
</html>